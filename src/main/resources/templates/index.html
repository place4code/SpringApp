<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{layouts/main_layout :: head(title = 'SpringApp index')}">
</head>
<body>

<nav th:replace="~{layouts/main_layout :: nav}"></nav>
<div th:replace="~{layouts/main_layout :: jumbotron}"></div>

<div class="container">



    <!-- links -->
    <div class="row link" th:each="link : ${links}">
        <div class="col-1">
            <div><a href="#" class="upvote" th:data-id="${link.id}"><i class="fas fa-arrow-up"></i></a></div>
            <div><span th:id="|votesCounter-${link.id}|" class="votesCounter" th:text="${link.getVotesCounter()}">0</span></div>
            <div><a href="#" class="downvote" th:data-id="${link.id}" th:disabled="true"><i class="fas fa-arrow-down"></i></a></div>
        </div>
        <div class="col-11">
            <p class="title">
                <a class="title" th:href="@{'/link/' + ${link.id}}" target="_blank" th:text="${link.titel}"></a>
                <span class="domain">(<a th:href="${link.url}" th:text="${link.getShortUrl()}"></a>)</span>
            </p>
            <p class="tagline ">submitted
                <time class="live-timestamp" th:text="${link.getPrettyDifference()}"></time> by
                <a href="profile.html" class="author" th:text="${link.createdBy}"></a>
            </p>
            <p>
                <a th:href="@{'/link/' + ${link.id} + '#comments'}" class="comments" th:text="|${link.getComments().size()} comments|"><i class="fas fa-comments"></i> 8 comments</a>
                <a href="#" class="share"><i class="fas fa-share-square"></i> share</a>
            </p>
        </div>
    </div>





    <!-- customers pagination -->
    <nav aria-label="Pagination" th:if="${links.totalPages > 0}">
        <ul class="pagination justify-content-center">
            <li class="page-item" th:classappend="${links.number == 0} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/?page={id}(id=${links.number < 2 ? 1 : links.number})}"
                   aria-label="Previous"
                   title="Previous Page" rel="tooltip">
                    <i class="fas fa-chevron-left"></i>
                </a>
            </li>
            <li class="page-item" th:classappend="${i == links.number + 1} ? 'active'"
                th:each="i : ${#numbers.sequence( links.number + 1, links.totalPages > 4 + links.number ? links.number + 4 : links.totalPages, 1)}">
                <a class="page-link" th:href="@{/?page={id}(id=${i})}" th:text="${i}"
                   th:title="${'Page '+ i}"
                   rel="tooltip"></a>
            </li>
            <li class="page-item disabled" th:if="${links.number + 10 < links.totalPages}">
                <a class="page-link svg-icon" href="#">
                    <span data-feather="more-horizontal" width="20" height="20"></span>
                </a>
            </li>
            <li class="page-item" th:classappend="${links.number + 1 == links.totalPages} ? 'disabled'">
                <a class="page-link" th:href="@{/?page={id}(id=${links.number + 2})}"
                   aria-label="Next"
                   title="Next Page" rel="tooltip">
                    <i class="fas fa-chevron-right"></i>
                </a>
            </li>
        </ul>
    </nav>






</div>


<script sec:authorize="isFullyAuthenticated()">
    const allvotes = document.querySelectorAll(".upvote, .downvote");
    for(let i=0; i<allvotes.length; i++) {
        let className = allvotes[i].className;
        allvotes[i].addEventListener('click', function (event) {
            const direction = className === 'upvote' ? 1 : -1;
            const linkID = this.getAttribute("data-id");
            const voteSum = document.getElementById('votesCounter-' + linkID);
            const voteSumValue = voteSum.innerHTML;

            fetch(`http://localhost:8090/vote/link/${linkID}/direction/${direction}/votesCounter/${voteSumValue}`)
                .then(response => response.json())
                .then(data => voteSum.innerHTML = data)
                .catch(err => console.error(err));
        });
    }
</script>




<section th:replace="~{layouts/main_layout :: bootstrap_js}"></section>
</body>
</html>